# ğŸ¦ VISE API - Sistema de GestiÃ³n de Tarjetas de CrÃ©dito

## ğŸ‘¥ Equipo de Desarrollo

- **Nicolas Hernandez Archila** - [@Nicolas-Archila](https://github.com/Nicolas-Archila)
- **Vanessa Alejandra Vasquez Martinez** - DevOps A
- **Juan Jose Martinez Lotero**

---

## ğŸ“‹ DescripciÃ³n del Proyecto

VISE API es un sistema completo de gestiÃ³n de tarjetas de crÃ©dito que implementa prÃ¡cticas modernas de DevOps, incluyendo:

- âœ… **CI/CD automatizado** con GitHub Actions
- âœ… **ContenedorizaciÃ³n** con Docker
- âœ… **Despliegue continuo** a Azure
- âœ… **Monitoreo en tiempo real** con Axiom
- âœ… **Tests automatizados** con Hurl
- âœ… **Arquitectura de microservicios**

---

## ğŸ—ï¸ Arquitectura del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚   Frontend      â”‚â”€â”€â”€â”€â”€â–¶â”‚   Backend API   â”‚â”€â”€â”€â”€â”€â–¶â”‚   PostgreSQL    â”‚
â”‚   (Nginx)       â”‚      â”‚   (Node.js)     â”‚      â”‚   Database      â”‚
â”‚   Port: 8080    â”‚      â”‚   Port: 3000    â”‚      â”‚   Port: 5432    â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Axiom Monitoring & Logging              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Inicio RÃ¡pido

### Prerrequisitos

- [Docker](https://www.docker.com/) instalado
- [Node.js 18+](https://nodejs.org/) (opcional, para desarrollo local)
- [Git](https://git-scm.com/)

### InstalaciÃ³n Local

```bash
# 1. Clonar el repositorio
git clone https://github.com/Nicolas-Archila/vise-apii.git
cd vise-apii

# 2. Levantar todos los servicios con Docker Compose
docker compose up --build

# 3. La API estarÃ¡ disponible en:
# - Frontend: http://localhost:8080
# - Backend API: http://localhost:3000
# - PostgreSQL: localhost:5432
```

### Desarrollo sin Docker

```bash
# 1. Instalar dependencias
cd vise-api
npm install

# 2. Configurar variables de entorno (opcional)
export PORT=3000
export AXIOM_TOKEN="tu_token_aqui"
export AXIOM_DATASET="vise-api-logs"

# 3. Iniciar servidor
npm start
```

---

## ğŸ“¡ Endpoints de la API

### 1ï¸âƒ£ **POST /client** - Crear Cliente

Registra un nuevo cliente y valida su elegibilidad para tarjetas.

**Request:**
```json
POST http://localhost:3000/client
Content-Type: application/json

{
  "name": "Juan PÃ©rez",
  "country": "Colombia",
  "monthlyIncome": 1500,
  "viseClub": true,
  "cardType": "Platinum"
}
```

**Response (200 OK):**
```json
{
  "clientId": 1,
  "name": "Juan PÃ©rez",
  "cardType": "Platinum",
  "status": "Registered",
  "message": "Cliente apto para tarjeta Platinum"
}
```

**Validaciones:**
- **Classic**: Sin requisitos
- **Gold**: Ingreso â‰¥ $500 USD
- **Platinum**: Ingreso â‰¥ $1000 USD + VISE CLUB
- **Black/White**: Ingreso â‰¥ $2000 USD + VISE CLUB + No residir en paÃ­ses restringidos

---

### 2ï¸âƒ£ **POST /purchase** - Realizar Compra

Procesa una compra y aplica descuentos segÃºn la tarjeta y condiciones.

**Request:**
```json
POST http://localhost:3000/purchase
Content-Type: application/json

{
  "clientId": 1,
  "amount": 250,
  "currency": "USD",
  "purchaseDate": "2025-11-18T14:30:00Z",
  "purchaseCountry": "France"
}
```

**Response (200 OK):**
```json
{
  "status": "Approved",
  "purchase": {
    "clientId": 1,
    "originalAmount": 250,
    "discountApplied": 50,
    "finalAmount": 200,
    "benefit": "Descuento 20%"
  }
}
```

**Descuentos Aplicables:**

| Tarjeta  | Condiciones                                    | Descuento |
|----------|------------------------------------------------|-----------|
| Gold     | Lun-MiÃ© + Monto > $100                         | 15%       |
| Platinum | Lun-MiÃ© + Monto > $100                         | 20%       |
| Platinum | SÃ¡bado + Monto > $200                          | 30%       |
| Platinum | Compra en el extranjero                        | 5%        |
| Black    | Lun-MiÃ© + Monto > $100                         | 25%       |
| Black    | SÃ¡bado + Monto > $200                          | 35%       |
| White    | Lun-Vie + Monto > $100                         | 25%       |
| White    | SÃ¡b-Dom + Monto > $200                         | 35%       |

---

### 3ï¸âƒ£ **GET /clients** - Listar Clientes

```bash
GET http://localhost:3000/clients
```

### 4ï¸âƒ£ **GET /health** - Health Check

```bash
GET http://localhost:3000/health
```

---

## ğŸ”„ Flujo DevOps Implementado

### **1. ConstrucciÃ³n y Testing (CI)**

**Workflow:** `.github/workflows/main.yml`

```yaml
Trigger: workflow_dispatch (manual)
Steps:
  1. Checkout del cÃ³digo
  2. Build de imÃ¡genes Docker (frontend + backend)
  3. EjecuciÃ³n de contenedores
  4. Tests automatizados con Hurl
  5. Cleanup de recursos
```

**Ejecutar manualmente:**
1. Ve a **Actions** en GitHub
2. Selecciona "Build and test VISE API"
3. Click en "Run workflow"
4. Ingresa el puerto (ej: 3000)
5. Click "Run workflow"

---

### **2. Despliegue Continuo (CD)**

**Workflow:** `.github/workflows/cd.yml`

```yaml
Trigger: workflow_dispatch (manual)
Steps:
  1. Build de imÃ¡genes Docker
  2. Push a Azure Container Registry
  3. Deploy a Azure App Service
  4. Health check del deployment
  5. Reporte de despliegue
```

**Requisitos de Secretos en GitHub:**

```bash
AZURE_REGISTRY_NAME          # Nombre del ACR (sin .azurecr.io)
AZURE_REGISTRY_USERNAME      # Usuario del ACR
AZURE_REGISTRY_PASSWORD      # Password del ACR
AZURE_CREDENTIALS            # JSON de service principal
AZURE_APP_NAME               # Nombre del App Service
AZURE_RESOURCE_GROUP         # Grupo de recursos en Azure
```

**Configurar secretos:**
```bash
Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
```

---

## ğŸ“Š Monitoreo con Axiom

El sistema integra **Axiom** para logging y monitoreo en tiempo real.

### ConfiguraciÃ³n

```bash
# Variables de entorno
AXIOM_TOKEN=xaat-your-token-here
AXIOM_DATASET=vise-api-logs
```

### Eventos Monitoreados

- âœ… `client_created` - Registro de nuevos clientes
- âœ… `purchase_completed` - Compras procesadas
- âœ… `http_request` - Todas las peticiones HTTP
- âœ… `error` - Errores capturados
- âœ… `metric` - MÃ©tricas de rendimiento (response time)

### Dashboard en Axiom

Accede a [axiom.co](https://axiom.co) y visualiza:
- Total de clientes registrados
- Volumen de compras por hora
- Tiempo promedio de respuesta
- Tasa de errores
- DistribuciÃ³n de tarjetas

---

## ğŸ§ª Testing

### Tests Automatizados (Hurl)

El archivo `session.hurl` contiene 8 tests que validan:

1. âœ… Health check de la API
2. âœ… Crear cliente Platinum
3. âœ… Crear cliente Gold
4. âœ… Compra con descuento
5. âœ… Compra sin descuento
6. âœ… ValidaciÃ³n de campos requeridos
7. âœ… Cliente inexistente (404)
8. âœ… Listar todos los clientes

**Ejecutar tests localmente:**

```bash
# Instalar Hurl
brew install hurl  # macOS
# o
sudo apt install hurl  # Linux

# Ejecutar tests
hurl --variable host=http://localhost:3000 --test ./session.hurl
```

### Load Testing (Artillery)

```bash
cd vise-api
npm run test:load
```

---

## ğŸ³ Docker

### Construir imÃ¡genes manualmente

```bash
# Backend
docker build -t vise-api:latest ./vise-api

# Frontend
docker build -t vise-frontend:latest ./frontend

# Ejecutar
docker run -d -p 3000:3000 vise-api:latest
docker run -d -p 8080:80 vise-frontend:latest
```

### Docker Compose

```bash
# Levantar todos los servicios
docker compose up -d

# Ver logs
docker compose logs -f

# Detener
docker compose down

# Limpiar volÃºmenes
docker compose down -v
```

---

## ğŸ“ Estructura del Proyecto

```
vise-apii/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ main.yml          # CI - Build & Test
â”‚       â””â”€â”€ cd.yml            # CD - Deploy to Azure
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ vise-api/
â”‚   â”œâ”€â”€ index.js              # API principal
â”‚   â”œâ”€â”€ axiom.js              # Cliente de Axiom
â”‚   â”œâ”€â”€ instrumentation.mjs   # OpenTelemetry
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ session.hurl              # Tests de API
â””â”€â”€ README.md
```

---

## ğŸ” Variables de Entorno

| Variable                              | DescripciÃ³n                    | Default         |
|---------------------------------------|--------------------------------|-----------------|
| `PORT`                                | Puerto del servidor            | `3000`          |
| `AXIOM_TOKEN`                         | Token de autenticaciÃ³n Axiom   | -               |
| `AXIOM_DATASET`                       | Dataset en Axiom               | `vise-api-logs` |
| `NODE_ENV`                            | Entorno (dev/prod)             | `development`   |
| `DATABASE_URL`                        | URL de PostgreSQL              | -               |

---

## ğŸ“¹ Video Demostrativo

ğŸ¥ [Ver demo completa en YouTube](#)

El video incluye:
1. âœ… EjecuciÃ³n del workflow de CI (Build & Test)
2. âœ… EjecuciÃ³n del workflow de CD (Deploy a Azure)
3. âœ… Prueba manual del endpoint POST /client
4. âœ… Prueba manual del endpoint POST /purchase
5. âœ… VisualizaciÃ³n de logs en Axiom
6. âœ… VerificaciÃ³n del despliegue en Azure

---

## ğŸ“ Criterios de EvaluaciÃ³n Cumplidos

| # | Criterio                            | Evidencia                                          |
|---|-------------------------------------|----------------------------------------------------|
| 1 | Uso de Git colaborativo             | âœ… Historial de commits, ramas y pull requests     |
| 2 | ConstrucciÃ³n de imagen Docker       | âœ… Dockerfiles funcionales + docker-compose.yml    |
| 3 | IntegraciÃ³n continua (CI)           | âœ… `.github/workflows/main.yml` funcionando        |
| 4 | Despliegue continuo (CD)            | âœ… `.github/workflows/cd.yml` a Azure              |
| 5 | Trazabilidad y monitorizaciÃ³n       | âœ… Axiom configurado con logs y mÃ©tricas           |
| 6 | ColaboraciÃ³n y presentaciÃ³n         | âœ… README documentado + video demostrativo         |

---

## ğŸ› ï¸ Troubleshooting

### Error: "Cannot connect to Docker daemon"

```bash
# Verificar que Docker estÃ© corriendo
docker info

# Reiniciar Docker Desktop
```

### Error: "Port 3000 already in use"

```bash
# Cambiar puerto en docker-compose.yml o matar proceso
lsof -ti:3000 | xargs kill -9
```

### Tests de Hurl fallan

```bash
# Verificar que la API estÃ© corriendo
curl http://localhost:3000/health

# Ejecutar con modo verbose
hurl --verbose --variable host=http://localhost:3000 --test ./session.hurl
```

---

## ğŸ“š Recursos Adicionales

- [DocumentaciÃ³n de Express](https://expressjs.com/)
- [Docker Compose Docs](https://docs.docker.com/compose/)
- [GitHub Actions](https://docs.github.com/en/actions)
- [Azure Container Registry](https://docs.microsoft.com/en-us/azure/container-registry/)
- [Axiom Docs](https://axiom.co/docs)
- [Hurl Testing](https://hurl.dev/)

---

## ğŸ“„ Licencia

Este proyecto es parte del curso de DevOps y estÃ¡ bajo licencia MIT.

---

## ğŸ¤ Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

---

**Desarrollado con â¤ï¸ por el equipo VISE DevOps**